{% extends 'base.html' %}

{% block title %}
  Candidates
{% endblock %}

{% block content %}
  <div class="row">
    <div class="col">
      <!-- Header Section -->
      <nav class="navbar navbar-light bg-white shadow-sm mb-4">
        <div class="container">
          <h1 class="navbar-brand">Candidates for Senior Product Manager</h1>
          <p class="text-muted">Acme Inc. is seeking an experienced Senior Product Manager to lead the development and execution of our product strategy. In this role, you will collaborate with cross-functional teams, including engineering, design, marketing, and sales, to drive the product lifecycle from concept to launch. You will be responsible for defining the product roadmap, prioritizing features, and ensuring alignment with customer needs and business goals. The ideal candidate has a proven track record in product management, strong analytical and problem-solving skills, and the ability to balance customer feedback with business objectives. Experience in agile methodologies and excellent communication skills are essential for success in this role. Join us and help shape the future of innovation at Acme Inc.</p>
          <div>
            <button class="btn btn-primary me-2">Export Shortlist</button>
            <button class="btn btn-secondary me-2">Calibrate Position</button>
            <button class="btn btn-outline-danger">Close Job</button>
          </div>
        </div>
      </nav>

      <!-- Candidates Table -->
      <div class="table-responsive">
        <table id="candidatesTable" class="table table-striped table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th onclick="sortTable(0)">
                Candidate <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable(1)">
                Work Experience <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable(2)">
                Technical Skills <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable(3)">
                Soft Skills <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable(4)">
                Location <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable(5)">
                Industry <i class="fas fa-sort"></i>
              </th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for opp in opportunities %}
              <tr id="candidate-{{ opp.id }}">
                <td>
                  <div class="d-flex align-items-center">
                    <i class="fas fa-user-circle fa-2x text-secondary me-3"></i>
                    <div>
                      <strong>{{ opp.name }}</strong><br />
                      <small class="text-muted">Senior Product Manager</small>
                    </div>
                  </div>
                </td>
                <td>
                  <div>
                    {% if opp.work_experience %}
                      {% for _ in range(opp.work_experience|int) %}
                        <i class="fas fa-star text-warning"></i>
                      {% endfor %}
                      <span>{{ opp.work_experience }}</span>
                    {% else %}
                      <span>No work experience data</span>
                    {% endif %}
                    <i class="fas fa-info-circle text-info ms-2" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#resumeModal-{{ opp.id }}"></i>
                  </div>
                </td>
                <td>
                  <div>
                    {% for _ in range(opp.technical_skills_score|int) %}
                      <i class="fas fa-star text-warning"></i>
                    {% endfor %}
                    <span>{{ opp.technical_skills_score }}</span>
                    <i class="fas fa-info-circle text-info ms-2" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#techSkillsModal-{{ opp.id }}"></i>
                  </div>
                </td>
                <td>
                  <div>
                    {% for _ in range(opp.soft_skills_score|int) %}
                      <i class="fas fa-star text-warning"></i>
                    {% endfor %}
                    <span>{{ opp.soft_skills_score }}</span>
                    <i class="fas fa-info-circle text-info ms-2" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#softSkillsModal-{{ opp.id }}"></i>
                  </div>
                </td>
                <td>{{ opp.location }}</td>
                <td>{{ opp.industry }}</td>
                <td>
                  <button id="shortlist-btn-{{ opp.id }}" onclick="toggleShortlist('{{ opp.id }}')" class="btn btn-primary">Shortlist</button>
                </td>
              </tr>

              <!-- Resume Modal for Candidate -->
              <div class="modal fade" id="resumeModal-{{ opp.id }}" tabindex="-1" aria-labelledby="resumeModalLabel-{{ opp.id }}" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="resumeModalLabel-{{ opp.id }}">{{ opp.name }}'s Resume</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <h6>Career History</h6>
                      {% for position in opp.positions %}
                        <p>{{ position.title }} at {{ position.org }} ({{ position.start.month }}/{{ position.start.year }} - {{ position.end.month }}/{{ position.end.year }})</p>
                      {% endfor %}
                      <h6>Education</h6>
                      {% for school in opp.schools %}
                        <p>{{ school.degree }} in {{ school.field }} from {{ school.org }} ({{ school.start.month }}/{{ school.start.year }} - {{ school.end.month }}/{{ school.end.year }})</p>
                      {% endfor %}
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Technical Skills Modal -->
              <div class="modal fade" id="techSkillsModal-{{ opp.id }}" tabindex="-1" aria-labelledby="techSkillsModalLabel-{{ opp.id }}" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="techSkillsModalLabel-{{ opp.id }}">{{ opp.name }}'s Technical Skills</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <ul>
                        {% for skill in opp.technical_skills_data %}
                          <li>{{ skill.skill }} ({{ skill.level }}): {{ skill.reason }}</li>
                        {% endfor %}
                      </ul>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Soft Skills Modal -->
              <div class="modal fade" id="softSkillsModal-{{ opp.id }}" tabindex="-1" aria-labelledby="softSkillsModalLabel-{{ opp.id }}" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="softSkillsModalLabel-{{ opp.id }}">{{ opp.name }}'s Soft Skills</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <ul>
                        {% for skill in opp.soft_skills_data %}
                          <li>{{ skill.skill }} ({{ skill.level }}): {{ skill.reason }}</li>
                        {% endfor %}
                      </ul>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}

{% block extrajs %}
  <!-- Sorting Script -->
  <script>
    function sortTable(n) {
      const table = document.getElementById('candidatesTable')
      let rows,
        switching,
        i,
        x,
        y,
        shouldSwitch,
        dir,
        switchcount = 0
      switching = true
      dir = 'asc' // Set the sorting direction to ascending
    
      while (switching) {
        switching = false
        rows = table.rows
        for (i = 1; i < rows.length - 1; i++) {
          shouldSwitch = false
          x = rows[i].getElementsByTagName('TD')[n]
          y = rows[i + 1].getElementsByTagName('TD')[n]
    
          const xContent = x.textContent.trim()
          const yContent = y.textContent.trim()
          const xValue = isNaN(xContent) ? xContent.toLowerCase() : parseFloat(xContent)
          const yValue = isNaN(yContent) ? yContent.toLowerCase() : parseFloat(yContent)
    
          if (dir === 'asc') {
            if (xValue > yValue) {
              shouldSwitch = true
              break
            }
          } else if (dir === 'desc') {
            if (xValue < yValue) {
              shouldSwitch = true
              break
            }
          }
        }
        if (shouldSwitch) {
          rows[i].parentNode.insertBefore(rows[i + 1], rows[i])
          switching = true
          switchcount++
        } else {
          if (switchcount === 0 && dir === 'asc') {
            dir = 'desc'
            switching = true
          }
        }
      }
    }
    
    function toggleShortlist(candidateId) {
      const row = document.getElementById(`candidate-${candidateId}`)
      const button = document.getElementById(`shortlist-btn-${candidateId}`)
    
      if (button.textContent === 'Shortlist') {
        row.classList.add('table-success')
        button.textContent = 'Unshortlist'
        button.classList.remove('btn-primary')
        button.classList.add('btn-danger')
      } else {
        row.classList.remove('table-success')
        button.textContent = 'Shortlist'
        button.classList.remove('btn-danger')
        button.classList.add('btn-primary')
      }
    }
  </script>
{% endblock %}
